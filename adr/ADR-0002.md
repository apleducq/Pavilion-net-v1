---
title: "ADR-0002: Privacy-Preserving Technology Stack"
project: "Pavilion Trust Broker"
status: accepted
version: 0.1.0
last_updated: 2025-01-08
---

## Context

Pavilion Trust Broker must enable verification between Relying Parties (RPs) and Data Providers (DPs) while maintaining privacy guarantees. The system needs to perform record linkage without exposing raw PII.

We need to choose privacy-preserving technologies for:
1. **Record Linkage**: Matching user records between RP and DP
2. **Data Minimization**: Only exposing necessary information
3. **Audit Trail**: Maintaining privacy in audit logs

## Decision

We will implement a **layered privacy approach** with different technologies for MVP vs Production:

### MVP Privacy Stack
- **Bloom-filter PPRL**: For privacy-preserving record linkage
- **SHA-256 Hashing**: For identifier obfuscation
- **Local Merkle Batching**: For audit trail integrity
- **No Raw PII Storage**: Only hashed data in memory/logs

### Production Privacy Stack
- **PSI (Private Set Intersection)**: Advanced record linkage
- **ZKP (Zero-Knowledge Proofs)**: For complex privacy guarantees
- **BBS+ Selective Disclosure**: For credential privacy
- **Blockchain Audit**: Public audit trail anchoring

## Consequences

### Positive
- **Privacy Guarantees**: No raw PII exposed during verification
- **Compliance Ready**: Meets GDPR and other privacy regulations
- **Scalable Approach**: Different technologies for different scales
- **Audit Integrity**: Cryptographically verifiable audit trails
- **Future Proof**: Can evolve to more advanced privacy technologies

### Negative
- **Implementation Complexity**: Privacy-preserving algorithms are complex
- **Performance Overhead**: Cryptographic operations add latency
- **Development Time**: More time needed for privacy implementation
- **Testing Complexity**: Privacy guarantees are hard to verify
- **Expertise Required**: Need specialized privacy engineering skills

### Mitigation Strategies
- **Phased Implementation**: Start with simpler MVP approach
- **Library Usage**: Leverage existing privacy-preserving libraries
- **Expert Consultation**: Work with privacy engineering experts
- **Comprehensive Testing**: Extensive testing of privacy guarantees
- **Documentation**: Clear documentation of privacy properties

## Alternatives Considered

### Homomorphic Encryption
- **Pros**: Strong privacy guarantees, supports complex computations
- **Cons**: High performance overhead, immature tooling, complex implementation
- **Rejection**: Too complex for MVP, performance impact too high

### Differential Privacy
- **Pros**: Strong privacy guarantees, well-understood theory
- **Cons**: Adds noise to results, complex parameter tuning
- **Rejection**: Not suitable for exact verification requirements

### Secure Multi-Party Computation (SMPC)
- **Pros**: Strong privacy guarantees, supports complex protocols
- **Cons**: High communication overhead, complex setup
- **Rejection**: Too complex for current use cases

### Simple Hashing Only
- **Pros**: Simple implementation, fast performance
- **Cons**: Vulnerable to rainbow table attacks, limited privacy
- **Rejection**: Insufficient privacy guarantees for production

## Implementation Plan

### MVP Phase (Months 1-3)
1. **Bloom-filter PPRL**: Implement basic privacy-preserving record linkage
2. **Identifier Hashing**: SHA-256 hashing with salt
3. **Audit Privacy**: Hash-based audit logging
4. **Testing**: Comprehensive privacy testing

### Production Phase (Months 4-12)
1. **PSI Implementation**: Advanced private set intersection
2. **ZKP Integration**: Zero-knowledge proof circuits
3. **BBS+ Credentials**: Selective disclosure capabilities
4. **Blockchain Audit**: Public audit trail anchoring

## Privacy Guarantees

### MVP Guarantees
- **No Raw PII Transmission**: Only hashed identifiers sent between services
- **No Raw PII Storage**: Only hashed data stored in databases
- **Audit Privacy**: Audit logs contain hashes only
- **Bloom-filter Privacy**: Probabilistic privacy for record linkage

### Production Guarantees
- **Zero-Knowledge**: Prove statements without revealing underlying data
- **Selective Disclosure**: Reveal only necessary credential attributes
- **Unlinkability**: Prevent correlation across different verifications
- **Public Verifiability**: Audit trails can be verified by third parties

## References

- [Privacy-Preserving Record Linkage](https://www.thoughtworks.com/radar/techniques/privacy-preserving-record-linkage-pprl-using-bloom-filter) - Bloom-filter PPRL technique
- [Private Set Intersection](https://openmined.org/blog/private-set-intersection/) - PSI protocols
- [Zero-Knowledge Proofs](https://en.wikipedia.org/wiki/Zero-knowledge_proof) - ZKP theory and applications
- [BBS+ Credentials](https://blog.worldline.tech/2024/05/14/bbs-plus-credentials.html) - Selective disclosure credentials
- [Merkle Trees](https://transparency.dev/) - Audit trail integrity 